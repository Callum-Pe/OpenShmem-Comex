# (c) 2011 University of Houston System.  All rights reserved.

# ---------------------------------------------------------

COMMS_DIR        =    ../comms
COMMS_CPPFLAGS   =    -I$(COMMS_DIR)

# ---------------------------------------------------------

MEMORY_DIR        =    ../memory
MEMORY_CPPFLAGS   =    -I$(MEMORY_DIR)

# ---------------------------------------------------------

ATOMIC_DIR        =    ../atomic
ATOMIC_CPPFLAGS   =    -I$(ATOMIC_DIR)

# ---------------------------------------------------------

CC               = @CC@
CFLAGS           = @CFLAGS@
CPPFLAGS         = @CPPFLAGS@
LD               = @LD@
LDFLAGS          = @LDFLAGS@

CPPFLAGS        += -I..

CPPFLAGS        += $(COMMS_CPPFLAGS)
CPPFLAGS        += $(MEMORY_CPPFLAGS)
CPPFLAGS        += $(ATOMIC_CPPFLAGS)
CPPFLAGS        += -I../modules

ifeq "@DEBUG@" "TRUE"
CPPFLAGS        += -DDEBUG
endif

CFLAGS          += -fPIC

MODULES = $(wildcard barrier-*.c)
OBJECTS = $(MODULES:.c=.o)
SHOBJECTS = $(MODULES:.c=.so)

.PHONY: all default install-lib uninstall-lib clean

all default:	$(SHOBJECTS) barrier.o

install-lib:	all default
	mkdir -p @MODULES_DIR@
	cp $(SHOBJECTS) @MODULES_DIR@

uninstall-lib:
	for f in $(SHOBJECTS); do rm -f @MODULES_DIR@/$$f; done
	- rmdir @MODULES_DIR@

%.so:	%.o
	$(LD) -shared $(LDFLAGS) $(CFLAGS) -o $@ $^

clean:
	rm -f $(OBJECTS) $(SHOBJECTS) barrier.o
