#!/bin/sh
#
# generated from OpenSHMEM src directory, don't edit installed version
#

progname="`basename $0`"

show_usage_and_exit()
{
  echo "Usage: $progname [conduit options] -np PEs program"
  exit 1
}

if [ $# -eq 0 ]
then
  show_usage_and_exit
fi

#
# pass through args, trap -np N
#

npes="not specified"
args=""

while [ $# -gt 0 ]
do
  case "$1" in
      -np)
	  shift
	  npes=$1
	  ;;
      *)
	  break
	  ;;
  esac
  shift
done

case "$npes" in
  [0-9]*)
    # good
    ;;
   *)
    show_usage_and_exit
    ;;
esac

cmd=$1
shift

case "@GASNET_CONDUIT@" in
    smp)
	RUN_IT="env GASNET_PSHM_NODES=$npes $cmd $@"
	;;
    udp)
        RUN_IT="$cmd $npes $@"
        ;;
    mpi|ibv)
	RUN_IT="@GASNET_LD@"
	# set number of PEs if provided (or may come from job scheduler)
	[ "$npes" ] && RUN_IT="$RUN_IT -np $npes $cmd $@"
	;;
    *)
	;;
esac

$RUN_IT
